<!-- The original code is from http://stackoverflow.com/questions/4767848/get-caret-cursor-position-in-contenteditable-area-containing-html-content, and was created by Tim Down -->
<html>
<body>
Non-editable text. Editable is below:
<p id="test" contenteditable="true">Hello, some <b>bold</b> and <i>italic and <b>bold</b></i> text</p>
<p>Selection Range: <span id="position"></span></p>
<script>
function isOutsideNode(range, node) {
    var nodeRange = document.createRange();
    nodeRange.selectNode(node);
    if (nodeRange.compareBoundaryPoints(Range.END_TO_START, range) > 0) {
        return true;
    }
    if (nodeRange.compareBoundaryPoints(Range.START_TO_END, range) < 0) {
        return true;
    }
    return false;
}

function getSelectionStart(range, node) {
    // If the selction starts before the node, returns 0.
    var nodeRange = document.createRange();
    nodeRange.selectNode(node);
    if (nodeRange.compareBoundaryPoints(Range.START_TO_START, range) > 0) {
        return 0;
    }
    
    var treeWalker = document.createTreeWalker(
        node,
        NodeFilter.SHOW_TEXT,
        function(node) {
            var nodeRange = document.createRange();
            nodeRange.selectNode(node);
            return nodeRange.compareBoundaryPoints(Range.START_TO_END, range) < 0 ?
                NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
        },
        false
    );

    var charCount = 0;
    while (treeWalker.nextNode()) {
        charCount += treeWalker.currentNode.length;
    }
    if (range.startContainer.nodeType == Node.TEXT_NODE) {
        charCount += range.startOffset;
    }
    return charCount;
}

function getSelectionEnd(range, node) {       
    var treeWalker = document.createTreeWalker(
        node,
        NodeFilter.SHOW_TEXT,
        function(node) {
            var nodeRange = document.createRange();
            nodeRange.selectNode(node);
            return nodeRange.compareBoundaryPoints(Range.END_TO_END, range) <= 0 ?
                NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
        },
        false
    );

    var charCount = 0;
    while (treeWalker.nextNode()) {
        charCount += treeWalker.currentNode.length;
    }

    var nodeRange = document.createRange();
    nodeRange.selectNode(node);
    if (nodeRange.compareBoundaryPoints(Range.END_TO_END, range) >= 0) {
        // The selection ends winth the node.
        if (range.endContainer.nodeType == Node.TEXT_NODE) {
            charCount += range.endOffset;
        };
    }
    return charCount;
}

setInterval(function() {
    var start = -1;
    var end = -1;
    var el = document.getElementById("test");
    var range = window.getSelection().getRangeAt(0);
    if (!isOutsideNode(range, el)) {
        start = getSelectionStart(range, el);
        end = getSelectionEnd(range, el);
    }
    document.getElementById("position").innerHTML = [start, end];
}, 100);
</script>
</body>
</htm>
